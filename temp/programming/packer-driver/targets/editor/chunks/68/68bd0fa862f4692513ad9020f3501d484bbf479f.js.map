{"version":3,"sources":["file:///C:/Users/PC/Desktop/Slot_Assignment/assets/scripts/MockApi.ts"],"names":["MockApi","DEFAULT_WIN_LINES","lineNumber","indexes","DEFAULT_BET","DEFAULT_BALANCE","PAY_PER_LINE","PLAY_DELAY_MS","onInitData","cb","initCallback","onPlayResponse","playCallback","init","data","gameId","defaultBet","balance","defaultReels","play","reels","buildRandomReels","winLines","evaluateWins","totalWin","reduce","sum","wl","winAmount","payload","roundId","Date","now","toString","setTimeout","randIcon","Math","floor","random","results","line","i0","i1","i2","v0","valueAt","v1","v2","push","winIndexes","slice","idx","col","row"],"mappings":"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","sourcesContent":["export type InitData = {\r\n    /** Mock game id. */\r\n    gameId: string;\r\n    /** Default bet amount for the game. */\r\n    defaultBet: number;\r\n    /** Starting player balance */\r\n    balance: number;\r\n    /**\r\n     * 3x3 starting layout with NO wins.\r\n     * Orientation is columns‑first: defaultReels[col][row]\r\n     * Example: defaultReels[0] is the left reel.\r\n     */\r\n    defaultReels: number[][];\r\n};\r\n\r\nexport type PlayData = {\r\n    /** Unique round id. */\r\n    roundId: string;\r\n    /**\r\n     * Final landed result for this spin, columns‑first: reels[col][row].\r\n     * Use this to set each symbol shown in your grid.\r\n     */\r\n    reels: number[][];\r\n    /** List of winning lines (empty if no win). */\r\n    winLines: WinLine[];\r\n    /** Sum of all line payouts in this result. */\r\n    totalWin: number;\r\n};\r\n\r\nexport type WinLine = {\r\n    /** Id of the winning line*/\r\n    lineNumber: number;\r\n    /** Payout for this single line. */\r\n    winAmount: number;\r\n    /**\r\n     * Grid indexes of the 3 cells that form the winning line.\r\n     * Grid is numbered column-first: reel0: 0,1,2; reel1: 3,4,5; reel2: 6,7,8\r\n     * Example: top row = [0,3,6], bottom row = [2,5,8]\r\n     */\r\n    winIndexes: number[];\r\n};\r\n\r\nconst DEFAULT_WIN_LINES: { lineNumber: number; indexes: number[] }[] = [\r\n    { lineNumber: 1, indexes: [0, 3, 6] },\r\n    { lineNumber: 2, indexes: [1, 4, 7] },\r\n    { lineNumber: 3, indexes: [2, 5, 8] },\r\n    { lineNumber: 4, indexes: [0, 4, 8] },\r\n    { lineNumber: 5, indexes: [2, 4, 6] },\r\n];\r\n\r\nconst DEFAULT_BET = 10;\r\nconst DEFAULT_BALANCE = 1000;\r\nconst PAY_PER_LINE = 10;\r\nconst PLAY_DELAY_MS = 400;\r\n\r\nexport class MockApi {\r\n    private static initCallback: ((data: InitData) => void) | null = null;\r\n    private static playCallback: ((data: PlayData) => void) | null = null;\r\n\r\n    /**\r\n     * Register a single callback for init data.\r\n     * Call this in your Main.onLoad() BEFORE calling MockApi.init().\r\n     *\r\n     * Example:\r\n     *   MockApi.onInitData(this.handleInit.bind(this));\r\n     */\r\n    public static onInitData(cb: (data: InitData) => void) {\r\n        this.initCallback = cb;\r\n    }\r\n\r\n    /**\r\n     * Register a single callback for play results.\r\n     * Call this in your Main.onLoad() BEFORE calling MockApi.play().\r\n     *\r\n     * Example:\r\n     *   MockApi.onPlayResponse(this.handlePlay.bind(this));\r\n     */\r\n    public static onPlayResponse(cb: (data: PlayData) => void) {\r\n        this.playCallback = cb;\r\n    }\r\n\r\n    /**\r\n     * Triggers the initial payload immediately (no delay).\r\n     * Call this ONCE during scene load (e.g., in Main.onLoad()).\r\n     */\r\n    public static init() {\r\n        const data: InitData = {\r\n            gameId: \"999\",\r\n            defaultBet: DEFAULT_BET,\r\n            balance: DEFAULT_BALANCE,\r\n            defaultReels: [\r\n                [1, 2, 3], // reel 0\r\n                [2, 4, 3], // reel 1\r\n                [4, 3, 1], // reel 2\r\n            ],\r\n        };\r\n        this.initCallback?.(data);\r\n    }\r\n\r\n    /**\r\n     * Triggers a spin result after a short delay (simulating server latency).\r\n     * Call this when the user presses the Play button.\r\n     */\r\n    public static play() {\r\n        const reels = this.buildRandomReels();          // columns‑first 3x3\r\n        const winLines = this.evaluateWins(reels);      // array of { lineNumber, winAmount, winIndexes }\r\n        const totalWin = winLines.reduce((sum, wl) => sum + wl.winAmount, 0);\r\n\r\n        const payload: PlayData = {\r\n            roundId: Date.now().toString(),\r\n            reels,\r\n            winLines,\r\n            totalWin,\r\n        };\r\n\r\n        setTimeout(() => this.playCallback?.(payload), PLAY_DELAY_MS);\r\n    }\r\n\r\n    private static randIcon(): number {\r\n        return Math.floor(Math.random() * 4) + 1; // 1..4\r\n    }\r\n\r\n    private static buildRandomReels(): number[][] {\r\n        return [\r\n            [this.randIcon(), this.randIcon(), this.randIcon()], // col 0\r\n            [this.randIcon(), this.randIcon(), this.randIcon()], // col 1\r\n            [this.randIcon(), this.randIcon(), this.randIcon()], // col 2\r\n        ];\r\n    }\r\n\r\n    private static evaluateWins(reels: number[][]): WinLine[] {\r\n        const results: WinLine[] = [];\r\n\r\n        for (const line of DEFAULT_WIN_LINES) {\r\n            const [i0, i1, i2] = line.indexes;\r\n\r\n            const v0 = this.valueAt(reels, i0);\r\n            const v1 = this.valueAt(reels, i1);\r\n            const v2 = this.valueAt(reels, i2);\r\n\r\n            if (v0 === v1 && v1 === v2) {\r\n                results.push({\r\n                    lineNumber: line.lineNumber,\r\n                    winAmount: v0 * PAY_PER_LINE,\r\n                    winIndexes: line.indexes.slice(),\r\n                });\r\n            }\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    private static valueAt(reels: number[][], idx: number): number {\r\n        const col = Math.floor(idx / 3);\r\n        const row = idx % 3;\r\n        return reels[col][row];\r\n    }\r\n}\r\n"]}